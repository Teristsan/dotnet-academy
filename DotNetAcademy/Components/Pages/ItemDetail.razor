@page "/item/{Id:int}"
@using DotNetAcademy.Models
@using DotNetAcademy.Persistence.Entities
@using Microsoft.AspNetCore.Components.Authorization
@rendermode InteractiveServer

<PageTitle>@(itemDetails?.Title ?? "Item Details")</PageTitle>

@if (isLoading)
{
    <div class="container mt-5">
        <div class="text-center">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>
}
else if (itemDetails != null)
{
    <div class="d-flex justify-content-center">
        <div class="mt-4 mb-5" style="width: 60%">
            <div class="row">
                <!-- Poster Section -->
                <div class="col-4">
                    <div class="card shadow-sm">
                        <img src="@GetPosterBase64()" class="card-img" alt="@itemDetails.Title" />
                    </div>
                </div>

                <!-- Details Section -->
                <div class="col-8 border rounded">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between p-2 ps-0">
                            <h1 class="fw-bold">@itemDetails.Title</h1>
                            @if (isDeletedSuccessfully)
                            {
                                <div class="alert alert-success" role="alert">
                                    Item deleted successfully.
                                </div>
                            }
                            <AuthorizeView Roles="Admin">
                                <button class="btn btn-danger" @onclick="() => DeleteItem(itemDetails.Id)"><i class="bi bi-trash"></i></button>
                            </AuthorizeView>
                        </div>
                        <span class="badge bg-dark me-2">@itemDetails.MediaType</span>
                    </div>

                    <div class="mb-3">
                        <div class="d-flex align-items-center mb-2">
                            <span class="text-warning fs-5 me-2">@GetStarRating()</span>
                            <strong class="fs-5">@itemDetails.Rating/10</strong>
                        </div>
                        <div class="text-muted">
                            <i class="bi bi-calendar-event me-1"></i>
                            <span>@itemDetails.ReleaseDate.ToString("MMMM dd, yyyy", System.Globalization.CultureInfo.GetCultureInfo("en-US"))</span>
                        </div>
                    </div>

                    <div class="mb-4">
                        @foreach (var genre in itemDetails.Genre.Split(',', StringSplitOptions.RemoveEmptyEntries))
                        {
                            <span class="badge bg-dark me-1">@genre.Trim()</span>
                        }
                    </div>

                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Overview</h5>
                            <p class="card-text">@itemDetails.Description</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Images Section -->
            <div class="d-flex flex-column justify-content-center align-items-center m-3">
                <h3>Gallery:</h3>
                <div class="">
                    @if (itemDetails.Images.Any())
                    {
                        <img src="@GetImageBase64(itemDetails.Images[currentImageIndex])" class="card-img-top mb-2" alt="Movie scene" />
                    }
                    <div class="d-flex justify-content-between">
                        @if (itemDetails.Images.Count > 1)
                        {
                            <button class="btn btn-dark me-2" @onclick="PreviousImage" disabled="@(currentImageIndex == 0)">Previous</button>
                            <button class="btn btn-dark" @onclick="NextImage" disabled="@(currentImageIndex == itemDetails.Images.Count - 1)">Next</button>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="container mt-5">
        <div class="alert alert-warning" role="alert">
            <h4 class="alert-heading">Item not found</h4>
            <p>The requested item could not be found.</p>
        </div>
    </div>
}
